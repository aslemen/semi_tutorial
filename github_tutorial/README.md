# Githubチュートリアル
こんにちは。
GithubやBitbucketなどのGitを利用したサービスは、研究以外でも複数人でのプロダクトの共同開発などにも用いられます。  
というかそちらがメインです。

ここでは、円滑な研究を行うという目的に限定した上でのGithubの基本的な使い方とワークフローについて説明します。  
Gitのインストールについてはググって各自の環境にインストールしてください。

~~というか、基本的な使い方に関してもググった方が早いです。~~

私もぺーぺーで使いこなせているわけではないので、そこら辺はご了承ください。

## Github上の誰かのリポジトリを使いたい場合
**clone**を行います。  
たとえば、今回のチュートリアルのコードを丸々自分のPCにダウンロードして使いたい場合、
```bash
git clone https://github.com/kwashio/semi_tutorial.git
```
このようにターミナルにコマンド入力するとリポジトリのダウンロードが始まります。  
サーバー上に自分のコードをGithubを経由して移したいときなども、このようにcloneを行えばOKです。  


## Github上でバージョン管理を行いたい場合
Gitにおいては**ローカルリポジトリ**（自分のPC上のフォルダ）と**リモートリポジトリ**（バージョン管理を行うサーバー上のフォルダ）を分けてバージョン管理を行います。  
ローカルリポジトリでコードを書き、それらをリモートリポジトリに反映していく、というのが基本です。  

まずはリポジトリの作成を行います。

## リポジトリの作成
コマンドターミナルからコマンドなどでやる方法もあるのですが、研究用のリポジトリはPrivate（非公開設定）にすることが多いので、
Githubのwebサイトで作った方が良いでしょう。  
作成後、好きな場所にcloneすればOKです。

## プログラムを追加・修正、そしてリモートリポジトリへの反映
リポジトリの作成の後、ローカルでコードを書いて、リモートに反映するまでは以下のようなプロセスになります。  
キーワードは、**add**, **commit**, **push**です。

### 1. ファイルを追加・修正し、**add**で変更を行ったファイルをリポジトリに登録。
```
git add hoge.py
```
「hoge.pyとファイルを追加 or 修正しました」

### 2. **commit**で変更内容の文字列とともに変更をリポジトリに登録。
```
git commit -m 'タイポの修正'
```
「'タイポの修正'という変更内容で、変更をリポジトリに登録します」

### 3. **push**して変更をリモートリポジトリに反映。
```
git push origin master
```
「originというリモートリポジトリのmasterブランチにpushしてください」  
ちなみにoriginはリモートリポジトリのあだ名、masterはブランチ名のデフォルトです。  
ブランチについては後に詳しく説明しますが、ここでは単純にバージョンと読み替えてください。  
originの部分は基本的にいじることはない（はず…）。

ローカルリポジトリからリモートリポジトリへの反映では、追加・修正 -> add -> commit -> pushがとにかく基本です。  
このプロセスはこまめに行いましょう。

## リモートリポジトリの状態をローカルリポジトリ反映する。
別のPCで作業を行ってリモートリポジトリに変更を反映した場合、それを元のPCにも反映する必要があります。  
また複数人で何かのプロダクトを作る場合は、誰かが行った反映を、自分のローカルリポジトリにも反映できなければなりません。  

これを行うプロセスは以下のようになります。  
キーワードは**fetch**, **merge**です。

### 1. **fetch**でリモートリポジトリの状態をローカルリポジトリに読み込む。
```bash
git fetch origin master
```
「originのmasterブランチの状態をローカルリポジトリに読み込んでください」  
これによってorigin/masterというブランチ（枝）が作成されます。  

### 2. **merge**で、現在いるブランチ（デフォルトのmasterブランチ）にorigin/masterブランチの状態を反映する。
```bash
git merge origin/maser
```
「現在いるブランチにorigin/masterの状態を反映してください」
これで、リモートリポジトリのmasterブランチの状態が、ローカルリポジトリのmasterブランチに反映されます。

リモートリポジトリからローカルリポジトリへの反映では、fetch -> mergeの流れが基本になります。  
なお、fetch -> mergeのプロセスをひとつにまとめた**pull**というコマンドもあります。
```bash
git pull origin master
```
これでも、リモートリポジトリのmasterブランチの内容が、ローカルリポジトリの現在いるブランチに反映されます。


## ブランチング
先程からブランチという言葉が使われています。  
Gitではブランチ（枝）を作成することで、リポジトリへの変更をわかりやすく管理することができます。  

さきほどコマンドに登場していたmasterブランチというのはデフォルトでありメインのブランチです。  
研究用に一人でリポジトリをいじっていく場合には、masterブランチだけを修正していっても十分です。  
どうせcommitの履歴が残り、そこにいつでも戻ることができます。  

しかし、新しい機能の追加や大きな仕様の変更などを行う際に、別のブランチを用意してそこで作業を行うと、
masterが元の状態のバックアップ・リファレンスの役割を果たしてくれるの便利です。

ブランチを行って作業を行うプロセスは以下のようになります。  
キーワードは**branch**, **checkout**です。

### 1. **branch**で、大きな変更のための新しいブランチ(new_hoge)を作成する。
```bash
git branch new_hoge
```
「new_hogeというブランチを作ってください」  
新しいnew_hogeというブランチが作成されます。  
なお`git branch`のみで、現在ローカルリポジトリに存在するブランチが確認できます。  
デフォルトの状態だとmasterのみです。

### 2. **checkout**で作業ブランチを変更する。
```bash
git checkout new_hoge
```
「作業ブランチをnew_hogeに移してください」  
作業ブランチがmasterからnew_hogeに移ります。  
再び`git branch`で確認すると、作業ブランチを示す*がnew_hogeについているはずです。

### 3. new_hogeで新しくファイルを追加したり、修正したりします。

add -> commitを行い、
```bash
git push origin new_hoge
```
「リモートリポジトリのnew_hogeブランチに変更を反映してください」  
これで、リモートリポジトリにnew_hogeでの変更を反映します。masterがnew_hogeになっていることに注意しましょう。  

### 4. 3を繰り返し、変更を終えたら、masterブランチにnew_hogeブランチをmergeする。
```bash
git checkout master
git merge new_hoge
```
mergeは現在いるブランチに別のブランチの状態を反映するものでした。  
これで今までnew_hogeブランチで行った作業内容がmasterブランチに反映されます。  
ローカルリポジトリのmasterブランチの状態が変わったので、それをリモートリポジトリにも反映します。
```bash
git push origin master
```
今回はリモートリポジトリのnew_hogeブランチではなくmasterブランチにpushします。

### 5. 用済みのnew_hogeブランチを削除する。
大きな変更はやり遂げたので、作業場であったnew_hogeブランチを削除します。
```bash
git branch -d new_hoge
git push origin :new_hoge
```
ブランチの削除はbranchに-dのオプションをつけることで行います。  
ブランチを削除するときはブランチ名の前にコロンがつきます。これは呪文だと思ってください。  
気になる方は↓  
http://shoma2da.hatenablog.com/entry/2014/03/08/234523  

## まとめ
お疲れ様でした。  
ここではgithubの初歩を学びました。簡単に研究で用いる分にはこれで十分かなと思います。  
より発展的な内容やエラーについてはググってください。  

今まではローカルでコードを書いて管理し、サーバーにscpで送るということをしていたと思いますが、  
githubを使えば、バックアップをとりつつ、簡単にサーバーにコードを移すことができます。  
コードを公開する際も、githubを用いることができます。  

ぜひ活用しましょう。

### 注意
githubにギガバイトクラスの教師データをpushするのはやめましょう。  
pushするのはあくまでプログラムだけ。  
サイズが大きいものはscpを使うように。

### 陥りがちだが話してないこと
自分のPCで作業しつつ、サーバー上で小さなバグ取りなどをして横着すると、pullなどを行う際にコンフリクトが発生しpullが中断されます。  
そのようなときは、コンフリクトを解消する必要があります。  
詳細はググるか、以下のようなサイトで。  
https://www.backlog.jp/git-guide/stepup/stepup2_7.html  
https://qiita.com/kota9/items/ae7506ee52ff3380309b
